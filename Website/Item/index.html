<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<title>Items</title>
	<meta name="theme-color" content="black">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Ravenloft Repository">
	<link rel="stylesheet" href="../styles.css">
	<link rel="shortcut icon" href="../favicon.ico">
	<script src="../sort.js" charset="utf-8"></script>
</head>

<body>
	<h1>
		<a href=".."		 >Official </a> |
		<a href="../3rdParty">3rd Party</a>
	</h1><hr />
	
	<h2>
		<a href="../Source"	  >Sources   </a> | 
		<a href="../Domain"	  >Domains   </a> | 
		<a href="../Location" >Locations </a> | 
		<a href="../Character">Characters</a> | 
		<a href="../Item"	  >Items	 </a>
	</h2><hr />
	
	<h2>
		<input type="button" onclick="SwapDisplay('all')" value="All Domains"> | 
		<input type="button" onclick="SwapDisplay('edition')" value = "By Edition"> | 
		<input type="button" onclick="SwapDisplay('domain')" value = "By Domain">
	</h2>
	<br/>
	<div id="all" style="display:block">
	<b style="font-size:25px">List of Items</b>
	<table cellspacing="0" cellpadding="3" rules="cols" border="1" id="MainTable">
		<tr style="background-color:Black">
			<th scope="col">
				<b>Name(s)</b>
			</th>
			<th scope="col">
				<b>Domain(s)</b>
			</th>
			<th scope="col">
				<b>Source(s)</b>
			</th>
		</tr>
	</table>
	</div>
	
	<div id="edition" style="display:none">
	<b style="font-size:25px">Domain Appearances per Edition</b>
	<table cellspacing="0" cellpadding="3" rules="cols" border="1" id="EditionTable">
		<tr style="background-color:Black">
			<th scope="col">
				<b>Name</b>
			</th>
		</tr>
	</table>
	</div>
	
	<div id="domain" style="display:none">
	<b style="font-size:25px">Items per Domain</b>
	<table cellspacing="0" cellpadding="3" rules="cols" border="1" id="domainTable">
		<tr style="background-color:Black">
			<th scope="col">
				<b>Name</b>
			</th>
			<th scope="col">
				<b>Domains</b>
			</th>
		</tr>
	</table>
	<div id="Afterdomain"></div>
	</div>
	
	<script>
	function SwapDisplay(name) {
		if (name == "all") {
			document.getElementById("all").style.display = "block";
			document.getElementById("edition").style.display = "none";
			document.getElementById("domain").style.display = "none";
		} else if (name == 'edition'){
			document.getElementById("all").style.display = "none";
			document.getElementById("edition").style.display = "block";
			document.getElementById("domain").style.display = "none";
		} else if (name == 'domain'){
			document.getElementById("all").style.display = "none";
			document.getElementById("edition").style.display = "none";
			document.getElementById("domain").style.display = "block";
		}
	}
	
	async function func(){
		const EditionTable = document.getElementById("EditionTable");
		const EditionData = await fetch("../Edition.csv");
		const Editions = (await EditionData.text()).split(',');
		for (edition of Editions) {
			const cell = document.createElement("th");
				cell.scope = "col";
				cell.innerHTML = "<b>" + edition + "</b>";
			EditionTable.rows[0].appendChild(cell);
		}
		
		const ItemsData = await fetch("data.json");
		const Items = await ItemsData.json();
		
		const ClusterArr = {};
		
		const MainTable = document.getElementById("MainTable");
		for (const item of Items) {
			const row = MainTable.insertRow(-1);
			const erow = EditionTable.insertRow(-1);
			
			let TotalNames = [];
			for (const altname of item.Name.split('/')){ //Cycle through alternate names
				const a = document.createElement("a");
				a.setAttribute("href", item.Name);
				a.innerHTML = item.Name;
				TotalNames.push(a.outerHTML);
			}
			row.insertCell(-1).innerHTML = erow.insertCell(-1).innerHTML = TotalNames.join(',');
			
			const Domains = item.Domains.split(',');
			let inputval = "";
			for (const domain of Domains) {
				let TotalNames = [];
				for (const altname of domain.split('/')){ //Cycle through alternate names
					a = document.createElement("a");
					a.setAttribute("href", "../Domain/" + domain);
					a.innerHTML = domain;
					TotalNames.push(a.outerHTML);
				}
				inputval += TotalNames.join(',') + ", ";
			}
			row.insertCell(-1).innerHTML = inputval.substring(0, inputval.length - 2);
			
			/*const Clusters = domain.Clusters.split(',');
			for (const cluster of Clusters) {
				ClusterArr[cluster] ??= [];
				ClusterArr[cluster].push(domain);
			}*/
			
			let sources = 0;
			for (const edition of item.Editions) {
				const cell = erow.insertCell(-1);
				if (edition > 0) {
					cell.innerText = edition;
					sources += edition;
				}
			}
			
			row.insertCell(-1).innerHTML = sources;
		}
		sortDate('MainTable',0);
		colorCode('EditionTable');
		
		/*const AfterCluster = document.getElementById("AfterCluster");
		const ClusterTable = document.getElementById("ClusterTable");
		for (const cluster of Object.keys(ClusterArr)) {
			let row = ClusterTable.insertRow(-1);
			
			const a = document.createElement("a");
			a.setAttribute("href", "#" + (cluster ? cluster : "Islands of Terror"));
			a.innerHTML = cluster ? cluster : "Islands of Terror";
			row.insertCell(-1).innerHTML = a.outerHTML;
			
			row.insertCell(-1).innerHTML = ClusterArr[cluster]?.length ?? 0;

			AfterCluster.append(document.createElement("br"));

			const b = document.createElement("b");
				b.style.fontSize = "25px";
				b.innerHTML = cluster ? cluster : "Islands of Terror";
			AfterCluster.append(b);

			const table = document.createElement("table");
				table.border = "1";
				table.rules = "cols";
				table.cellspacing = "0";
				table.cellpadding = "3";
				table.id = cluster ? cluster : "Islands of Terror";
			AfterCluster.append(table);

			row = table.insertRow(-1);
			row.style.backgroundColor  = "black";
				const cell = document.createElement("th");
				cell.scope = "col";
				cell.innerHTML = "<b>Name(s)</b>";
			row.appendChild(cell);
			
			for (const domain of ClusterArr[cluster]) {
				let TotalNames = [];
				for (const altname of domain.Name.split('/')){ //Cycle through alternate names
					const a = document.createElement("a");
					a.setAttribute("href", domain.Name);
					a.innerHTML = domain.Name;
					TotalNames.push(a.outerHTML);
				}
				row = table.insertRow(-1);
				row.insertCell(-1).innerHTML = TotalNames.join(',');
			}
			colorCode(table.id);
		}
		sortDate('ClusterTable',0);*/
	}
	func();
	</script>
</body>
</html>